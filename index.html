<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TRAGO AVATAR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body { background: linear-gradient(180deg,#ecfeff,#ffffff,#eff6ff); }
      .fx-shadow { text-shadow: 0 3px 10px rgba(0,0,0,.25); }
      .fx-glow   { text-shadow: 0 0 6px var(--fxcolor, #22d3ee), 0 0 14px var(--fxcolor, #22d3ee); }
      .fx-outline {
        text-shadow:
          -1px -1px 0 var(--fxcolor, #0f172a),
           1px -1px 0 var(--fxcolor, #0f172a),
          -1px  1px 0 var(--fxcolor, #0f172a),
           1px  1px 0 var(--fxcolor, #0f172a);
      }
      .title-gradient { -webkit-background-clip: text; background-clip: text; color: transparent; display: inline-block; }
      .banner-gradient { background: linear-gradient(120deg, rgba(34,211,238,.35), rgba(59,130,246,.35)); }
      .badge { font-size: 11px; padding: 2px 8px; border-radius: 999px; display: inline-flex; align-items: center; gap: 6px; }
      .badge-free { background: #e6fffb; color: #065f46; border: 1px solid #99f6e4; }
      .badge-sell { background: #fff7ed; color: #7c2d12; border: 1px solid #fed7aa; }
      .toast { animation: slideIn .35s ease; }
      @keyframes slideIn { from {transform: translateY(10px); opacity: 0;} to {transform: translateY(0); opacity:1;} }
    </style>
  </head>
  <body class="min-h-screen text-gray-900">
    <!-- Top/Nav -->
    <header class="sticky top-0 z-20 bg-white/70 backdrop-blur border-b">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-3">
        <h1 class="text-xl font-extrabold bg-gradient-to-r from-cyan-500 to-blue-600 bg-clip-text text-transparent">TRAGO AVATAR</h1>
        <div class="flex items-center gap-2 flex-wrap justify-end">
          <select id="catFilter" class="px-3 py-2 rounded-xl border bg-white">
            <option value="ALL">الكل</option>
            <option value="FREE">AVATAR FREE</option>
            <option value="FOR_SELL">AVATAR FOR SELL</option>
          </select>
          <input id="search" placeholder="بحث..." class="px-3 py-2 rounded-xl border" />
          <button id="ownerBtn" class="px-3 py-2 rounded-xl border">مالك؟</button>
          <button id="addBtn" class="hidden px-3 py-2 rounded-xl text-white bg-gradient-to-r from-cyan-500 to-blue-600">+ أضف أفتار</button>
          <button id="editProfile" class="hidden px-3 py-2 rounded-xl border">تعديل البروفايل</button>
        </div>
      </div>
    </header>

    <!-- Banner/Profile -->
    <section id="bannerWrap" class="relative">
      <div id="banner" class="h-48 sm:h-60 md:h-72 w-full banner-gradient"></div>
      <div class="max-w-6xl mx-auto px-4 -mt-10 sm:-mt-12 md:-mt-16 relative z-10">
        <div class="flex items-end gap-4">
          <img id="logo" alt="logo" class="w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 rounded-2xl border-4 border-white object-cover shadow-lg bg-white/80" />
          <div class="flex-1 pb-2">
            <h2 class="text-2xl font-extrabold bg-gradient-to-r from-cyan-500 to-blue-600 bg-clip-text text-transparent">TRAGO</h2>
            <p id="bio" class="text-sm text-gray-600 mt-1"></p>
          </div>
        </div>
      </div>
    </section>

    <!-- Gallery -->
    <main class="max-w-6xl mx-auto px-4 py-6">
      <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5"></div>
      <p id="empty" class="text-center text-gray-500 py-12 hidden">لا توجد عناصر</p>
    </main>

    <!-- Footer -->
    <footer class="border-t py-6 text-center text-sm text-gray-500">
      Made by TRAGO
    </footer>

    <!-- Lightbox -->
    <div id="lightbox" class="hidden fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4">
      <div class="relative w-full max-w-4xl" onclick="event.stopPropagation()">
        <img id="lbImg" src="" class="w-full max-h-[80vh] object-contain rounded-2xl shadow-lg" />
        <div class="mt-4 flex justify-between items-center text-white">
          <div class="flex gap-2">
            <button id="prev" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/20">←</button>
            <button id="next" class="px-3 py-2 rounded-xl bg-white/10 hover:bg-white/20">→</button>
          </div>
          <div class="flex gap-2">
            <a id="lbLink" target="_blank" class="px-4 py-2 bg-gradient-to-r from-cyan-400 to-blue-600 rounded-xl font-semibold">VRChat ↗</a>
            <button id="close" class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20">✕</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Avatar Modal -->
    <div id="modal" class="hidden fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4">
      <div class="w-full max-w-lg bg-white rounded-2xl p-5 border" onclick="event.stopPropagation()">
        <h3 class="text-lg font-bold mb-3">إضافة أفتار</h3>
        <input id="mName" class="w-full p-2 rounded-xl mb-2 border" placeholder="اسم الأفتار" />
        <input id="mLink" class="w-full p-2 rounded-xl mb-2 border" placeholder="رابط VRChat" />
        <textarea id="mImgs" class="w-full p-2 rounded-xl mb-2 border h-28" placeholder="روابط الصور (سطر لكل صورة)"></textarea>
        <div class="grid grid-cols-2 gap-3 items-center text-sm">
          <label>التصنيف:
            <select id="mCat" class="border rounded-lg px-2 py-1 ms-2">
              <option value="FREE">AVATAR FREE</option>
              <option value="FOR_SELL">AVATAR FOR SELL</option>
            </select>
          </label>
          <label>بداية التدرّج: <input id="mGradFrom" type="color" value="#22d3ee" class="align-middle ms-2"></label>
          <label>نهاية التدرّج: <input id="mGradTo" type="color" value="#3b82f6" class="align-middle ms-2"></label>
          <label>لون التأثير: <input id="mFxColor" type="color" value="#22d3ee" class="align-middle ms-2"></label>
          <label>نوع التأثير:
            <select id="mFx" class="border rounded-lg px-2 py-1 ms-2">
              <option value="none">بدون</option>
              <option value="shadow">ظل</option>
              <option value="glow">Glow</option>
              <option value="outline">Outline</option>
            </select>
          </label>
        </div>
        <div class="flex justify-end gap-2 mt-3">
          <button id="mCancel" class="px-4 py-2 rounded-xl border">إلغاء</button>
          <button id="mSave" class="px-4 py-2 rounded-xl text-white bg-gradient-to-r from-cyan-500 to-blue-600">حفظ</button>
        </div>
      </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="hidden fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4">
      <div class="w-full max-w-lg bg-white rounded-2xl p-5 border" onclick="event.stopPropagation()">
        <h3 class="text-lg font-bold mb-3">تعديل البروفايل</h3>
        <label class="text-sm">رابط صورة البانر:</label>
        <input id="pBanner" class="w-full p-2 rounded-xl mb-2 border" placeholder="https://example.com/banner.jpg" />
        <label class="text-sm">رابط اللوقو:</label>
        <input id="pLogo" class="w-full p-2 rounded-xl mb-2 border" placeholder="https://example.com/logo.png" />
        <label class="text-sm">البايو:</label>
        <textarea id="pBio" class="w-full p-2 rounded-xl mb-2 border h-28" placeholder="نبذة قصيرة عنك / عن الأفتارات..."></textarea>
        <div class="flex justify-end gap-2 mt-2">
          <button id="pCancel" class="px-4 py-2 rounded-xl border">إلغاء</button>
          <button id="pSave" class="px-4 py-2 rounded-xl text-white bg-gradient-to-r from-cyan-500 to-blue-600">حفظ</button>
        </div>
      </div>
    </div>

    <!-- Owner Login Modal (Nice UI) -->
    <div id="ownerModal" class="hidden fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4">
      <div class="w-full max-w-md bg-white rounded-2xl p-6 border shadow-xl text-center" onclick="event.stopPropagation()">
        <div class="mb-4">
          <div class="mx-auto w-16 h-16 rounded-2xl bg-gradient-to-r from-cyan-500 to-blue-600 flex items-center justify-center text-white text-2xl shadow">
            🔑
          </div>
        </div>
        <h3 class="text-xl font-extrabold mb-1 bg-gradient-to-r from-cyan-500 to-blue-600 bg-clip-text text-transparent">Owner Mode</h3>
        <p class="text-sm text-gray-600 mb-4">أدخل رمز المالك للمتابعة</p>
        <input id="ownerCode" type="password" inputmode="numeric" placeholder="••••••" class="w-full p-3 rounded-xl border text-center tracking-widest" />
        <div class="flex justify-center gap-2 mt-4">
          <button id="ownerCancel" class="px-4 py-2 rounded-xl border">إلغاء</button>
          <button id="ownerConfirm" class="px-4 py-2 rounded-xl text-white bg-gradient-to-r from-cyan-500 to-blue-600">دخول</button>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div id="toastWrap" class="fixed bottom-4 start-1/2 -translate-x-1/2 z-[70] space-y-2"></div>

<script>
  const OWNER_CODE = "102361";
  const KEY = "trago_items";
  const KEY_PROFILE = "trago_profile";
  const year = new Date().getFullYear();

  const defaultItems = [
    {
      id: "trago-main",
      name: "TRAGO AVATAR — Signature",
      vrchat: "https://vrchat.com/home/avatar/xxxxxxxx",
      images: [
        "https://images.unsplash.com/photo-1557264337-e8a93017fe92?w=1600&q=60&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1542751110-97427bbecf20?w=1600&q=60&auto=format&fit=crop"
      ],
      category: "FREE",
      textGradFrom: "#22d3ee",
      textGradTo: "#3b82f6",
      textFx: "glow",
      textFxColor: "#22d3ee",
      createdAt: new Date().toISOString().slice(0,10)
    }
  ];

  const defaultProfile = { banner: "", logo: "", bio: "مرحبًا! هذا معرض TRAGO لعرض أفتاراتي وروابطها على VRChat." };

  const state = {
    items: [], owner: false, query: "", picked: null, pickedIdx: 0,
    profile: {...defaultProfile},
    cat: "ALL"
  };

  // Helpers
  function normalizeDigits(s) {
    if (!s) return "";
    const map = {'٠':'0','١':'1','٢':'2','٣':'3','٤':'4','٥':'5','٦':'6','٧':'7','٨':'8','٩':'9'};
    return (""+s).replace(/[\u0660-\u0669]/g, d => map[d]).replace(/[\u200f\u200e\s]/g,'').trim();
  }
  function showToast(msg, ok=true) {
    const wrap = document.getElementById('toastWrap');
    const d = document.createElement('div');
    d.className = 'toast px-4 py-2 rounded-xl shadow border text-sm ' + (ok ? 'bg-white' : 'bg-red-600 text-white border-red-700');
    d.textContent = msg;
    wrap.appendChild(d);
    setTimeout(()=>{ d.remove(); }, 2500);
  }

  // Load/Save
  function load() {
    try {
      const raw = localStorage.getItem(KEY);
      state.items = raw ? JSON.parse(raw) : defaultItems;
      state.items.forEach(i => {
        if (!i.textGradFrom) i.textGradFrom = "#22d3ee";
        if (!i.textGradTo) i.textGradTo = "#3b82f6";
        if (!i.textFx) i.textFx = "none";
        if (!i.textFxColor) i.textFxColor = i.textGradTo;
        if (!i.category) i.category = "FREE";
      });
    } catch { state.items = defaultItems; }

    try {
      const pr = localStorage.getItem(KEY_PROFILE);
      state.profile = pr ? JSON.parse(pr) : {...defaultProfile};
    } catch { state.profile = {...defaultProfile}; }
  }
  function save() { localStorage.setItem(KEY, JSON.stringify(state.items)); }
  function saveProfile() { localStorage.setItem(KEY_PROFILE, JSON.stringify(state.profile)); }

  // Elements
  const grid = document.getElementById('grid');
  const empty = document.getElementById('empty');
  const search = document.getElementById('search');
  const ownerBtn = document.getElementById('ownerBtn');
  const addBtn = document.getElementById('addBtn');
  const editProfileBtn = document.getElementById('editProfile');
  const bannerDiv = document.getElementById('banner');
  const logoImg = document.getElementById('logo');
  const bioP = document.getElementById('bio');
  const catFilter = document.getElementById('catFilter');
  const ownerModal = document.getElementById('ownerModal');
  const ownerCode = document.getElementById('ownerCode');
  const ownerCancel = document.getElementById('ownerCancel');
  const ownerConfirm = document.getElementById('ownerConfirm');

  // Profile rendering
  function renderProfile() {
    if (state.profile.banner) {
      bannerDiv.style.background = `center/cover no-repeat url('${state.profile.banner}')`;
    } else {
      bannerDiv.style.background = ""; bannerDiv.classList.add('banner-gradient');
    }
    logoImg.src = state.profile.logo || "https://dummyimage.com/300x300/ffffff/0f172a.png&text=TRAGO";
    bioP.textContent = state.profile.bio || "";
  }

  // Title rendering
  function titleNode(item) {
    const span = document.createElement('span');
    span.className = 'title-gradient ' + (item.textFx === 'glow' ? 'fx-glow' : item.textFx === 'shadow' ? 'fx-shadow' : item.textFx === 'outline' ? 'fx-outline' : '');
    span.style.backgroundImage = `linear-gradient(90deg, ${item.textGradFrom}, ${item.textGradTo})`;
    span.style.setProperty('--fxcolor', item.textFxColor || item.textGradTo);
    span.textContent = item.name;
    return span;
  }

  function badgeNode(item) {
    const b = document.createElement('span');
    const isFree = item.category === 'FREE';
    b.className = 'badge ' + (isFree ? 'badge-free' : 'badge-sell');
    b.innerHTML = isFree ? 'AVATAR FREE' : 'AVATAR FOR SELL';
    return b;
  }

  function ownerControls(item) {
    const box = document.createElement('div');
    box.className = "absolute top-2 end-2 flex flex-wrap gap-2 bg-white/70 backdrop-blur px-2 py-2 rounded-xl border " + (state.owner ? '' : 'hidden');
    box.innerHTML = `
      <div class="flex items-center gap-1 text-xs">
        <span>من</span><input type="color" value="${item.textGradFrom}" data-gfrom="${item.id}" class="w-7 h-7 p-0 border rounded">
        <span>إلى</span><input type="color" value="${item.textGradTo}" data-gto="${item.id}" class="w-7 h-7 p-0 border rounded">
        <span>Fx</span>
        <select data-fx="${item.id}" class="border rounded px-1 py-0.5">
          <option value="none" ${item.textFx==='none'?'selected':''}>بدون</option>
          <option value="shadow" ${item.textFx==='shadow'?'selected':''}>ظل</option>
          <option value="glow" ${item.textFx==='glow'?'selected':''}>Glow</option>
          <option value="outline" ${item.textFx==='outline'?'selected':''}>Outline</option>
        </select>
        <input type="color" title="لون التأثير" value="${item.textFxColor || item.textGradTo}" data-fxcolor="${item.id}" class="w-7 h-7 p-0 border rounded">
        <select data-cat="${item.id}" class="border rounded px-1 py-0.5">
          <option value="FREE" ${item.category==='FREE'?'selected':''}>FREE</option>
          <option value="FOR_SELL" ${item.category==='FOR_SELL'?'selected':''}>FOR SELL</option>
        </select>
        <button class="px-2 py-1 rounded-lg bg-red-600 text-white" data-del="${item.id}">حذف</button>
      </div>`;
    return box;
  }

  function card(item) {
    const d = document.createElement('div');
    d.className = "relative rounded-2xl overflow-hidden border bg-white shadow hover:shadow-lg transition";
    d.innerHTML = \`
      <button class="text-right w-full" data-open="\${item.id}">
        <img src="\${item.images?.[0] || ''}" class="w-full h-56 object-cover" alt="\${item.name}"/>
        <div class="p-4">
          <div class="flex items-center justify-between gap-2 mb-1">
            <h3 class="text-lg font-bold" data-title="\${item.id}"></h3>
            <span data-badge="\${item.id}"></span>
          </div>
          <p class="text-xs text-gray-500 mt-1">\${item.createdAt}</p>
          <a href="\${item.vrchat}" target="_blank" class="inline-block mt-3 px-3 py-1 rounded-xl text-white bg-gradient-to-r from-cyan-400 to-blue-600">VRChat ↗</a>
        </div>
      </button>\`;

    d.querySelector('[data-open]').onclick = () => openLightbox(item);

    const titleMount = d.querySelector(\`[data-title="\${item.id}"]\`);
    titleMount.appendChild(titleNode(item));
    const badgeMount = d.querySelector(\`[data-badge="\${item.id}"]\`);
    badgeMount.appendChild(badgeNode(item));

    const controls = ownerControls(item);
    d.appendChild(controls);

    if (state.owner) {
      const gfrom = controls.querySelector(\`[data-gfrom="\${item.id}"]\`);
      const gto = controls.querySelector(\`[data-gto="\${item.id}"]\`);
      const fx = controls.querySelector(\`[data-fx="\${item.id}"]\`);
      const fxcolor = controls.querySelector(\`[data-fxcolor="\${item.id}"]\`);
      const catSel = controls.querySelector(\`[data-cat="\${item.id}"]\`);
      const delBtn = controls.querySelector(\`[data-del="\${item.id}"]\`);

      gfrom.oninput = (e) => { item.textGradFrom = e.target.value; save(); render(); };
      gto.oninput = (e) => { item.textGradTo = e.target.value; save(); render(); };
      fx.oninput = (e) => { item.textFx = e.target.value; save(); render(); };
      fxcolor.oninput = (e) => { item.textFxColor = e.target.value; save(); render(); };
      catSel.oninput = (e) => { item.category = e.target.value; save(); render(); };
      delBtn.onclick = () => {
        if (confirm('تحذف هذا الأفتار؟')) {
          state.items = state.items.filter(x => x.id !== item.id);
          save(); render();
        }
      };
    }

    return d;
  }

  function render() {
    renderProfile();
    grid.innerHTML = "";
    const q = state.query.toLowerCase();
    const list = state.items.filter(i => {
      const bySearch = !q || i.name.toLowerCase().includes(q);
      const byCat = state.cat === 'ALL' || i.category === state.cat;
      return bySearch && byCat;
    });
    if (list.length === 0) { empty.classList.remove('hidden'); addBtn.classList.toggle('hidden', !state.owner); editProfileBtn.classList.toggle('hidden', !state.owner); return; }
    empty.classList.add('hidden');
    list.forEach(i => grid.appendChild(card(i)));
    addBtn.classList.toggle('hidden', !state.owner);
    editProfileBtn.classList.toggle('hidden', !state.owner);
  }

  // Lightbox logic
  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lbImg');
  const lbLink = document.getElementById('lbLink');
  document.getElementById('close').onclick = closeLightbox;
  document.getElementById('prev').onclick = () => step(-1);
  document.getElementById('next').onclick = () => step(+1);
  lb.onclick = closeLightbox;
  function openLightbox(item) { state.picked = item; state.pickedIdx = 0; lbImg.src = item.images[0]; lbLink.href = item.vrchat; lb.classList.remove('hidden'); }
  function closeLightbox(){ lb.classList.add('hidden'); state.picked=null; }
  function step(dir){ if(!state.picked) return; const n = state.picked.images.length; state.pickedIdx = (state.pickedIdx + dir + n) % n; lbImg.src = state.picked.images[state.pickedIdx]; }

  // Owner login modal behavior
  ownerBtn.onclick = () => {
    if (state.owner) {
      state.owner = false;
      showToast('تم الخروج من وضع المالك', false);
      render();
    } else {
      ownerCode.value = "";
      ownerModal.classList.remove('hidden');
      setTimeout(()=>ownerCode.focus(), 50);
    }
  };
  ownerCancel.onclick = () => ownerModal.classList.add('hidden');
  ownerConfirm.onclick = tryOwnerLogin;
  ownerCode.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter') tryOwnerLogin();
  });
  function tryOwnerLogin(){
    const normalized = normalizeDigits(ownerCode.value);
    if (normalized === OWNER_CODE) {
      state.owner = true;
      ownerModal.classList.add('hidden');
      showToast('Welcome TRAGO! ✅');
      render();
    } else {
      showToast('الرمز غير صحيح', false);
    }
  }

  // Add Modal
  const modal = document.getElementById('modal');
  const mName = document.getElementById('mName');
  const mLink = document.getElementById('mLink');
  const mImgs = document.getElementById('mImgs');
  const mGradFrom = document.getElementById('mGradFrom');
  const mGradTo = document.getElementById('mGradTo');
  const mFx = document.getElementById('mFx');
  const mFxColor = document.getElementById('mFxColor');
  const mCat = document.getElementById('mCat');
  document.getElementById('mCancel').onclick = () => modal.classList.add('hidden');
  document.getElementById('mSave').onclick = () => {
    const name = mName.value.trim();
    const vrchat = mLink.value.trim();
    const imgs = mImgs.value.split(/\n|,\s*/).map(s=>s.trim()).filter(Boolean);
    const gradFrom = mGradFrom.value || "#22d3ee";
    const gradTo = mGradTo.value || "#3b82f6";
    const fx = mFx.value || "none";
    const fxColor = mFxColor.value || gradTo;
    const cat = mCat.value || "FREE";
    if(!name || !vrchat || imgs.length === 0) return showToast('املأ الحقول', false);
    const obj = {
      id: name.toLowerCase().replace(/[^a-z0-9]+/g,'-').slice(0,40),
      name, vrchat, images: imgs, category: cat,
      textGradFrom: gradFrom, textGradTo: gradTo, textFx: fx, textFxColor: fxColor,
      createdAt: new Date().toISOString().slice(0,10)
    };
    state.items.unshift(obj); save(); modal.classList.add('hidden');
    mName.value=''; mLink.value=''; mImgs.value=''; mGradFrom.value='#22d3ee'; mGradTo.value='#3b82f6'; mFx.value='none'; mFxColor.value='#22d3ee'; mCat.value='FREE';
    render(); showToast('تمت الإضافة ✅');
  };
  addBtn.onclick = () => modal.classList.remove('hidden');

  // Profile Modal
  const profileModal = document.getElementById('profileModal');
  const pBanner = document.getElementById('pBanner');
  const pLogo = document.getElementById('pLogo');
  const pBio = document.getElementById('pBio');
  document.getElementById('pCancel').onclick = () => profileModal.classList.add('hidden');
  document.getElementById('pSave').onclick = () => {
    state.profile.banner = pBanner.value.trim();
    state.profile.logo = pLogo.value.trim();
    state.profile.bio = pBio.value.trim();
    saveProfile(); profileModal.classList.add('hidden'); renderProfile(); showToast('تم حفظ البروفايل ✅');
  };
  document.getElementById('editProfile').onclick = () => {
    pBanner.value = state.profile.banner || "";
    pLogo.value = state.profile.logo || "";
    pBio.value = state.profile.bio || "";
    profileModal.classList.remove('hidden');
  };

  // Filters & Search
  catFilter.oninput = () => { state.cat = catFilter.value; render(); };
  search.oninput = () => { state.query = search.value; render(); };

  // Init
  load(); render();
</script>
  </body>
</html>
